<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Punjab University Gujranwala Campus</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">
    <style>
        .dropdown-menu {
            display: none;
        }
    </style>
</head>

<body>
    <div>
        <!-- Navigation bar -->
        <nav class="navbar navbar-expand-lg navbar-light fixed-top" style="background-color: #00457C;">
            <div class="container-fluid">
                <a class="navbar-brand text-light" href="./index.html" style="padding-left: 50px;">
                    University of the Punjab Gujranwala Campus, Gujranwala
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse justify-content-end" id="navbarNav" style="padding-right: 150px;">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link text-light" href="./index.html">Home</a>
                        </li>
                        <li class="nav-item" id="authMenu">
                            <button class="nav-link text-light d-none" id="logoutButton">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-power" viewBox="0 0 16 16">
                                    <path d="M7.5 1v7h1V1h-1z" />
                                    <path
                                        d="M3 8.812a4.999 4.999 0 0 1 2.578-4.375l-.485-.874A6 6 0 1 0 11 3.616l-.501.865A5 5 0 1 1 3 8.812z" />
                                </svg> Logout</button>
                            <a class="nav-link text-light" href="#" id="loginSignupMenu" data-bs-toggle="modal"
                            data-bs-target="#authModal2">
                                Login / Signup
                            </a>
                        </li>
                    </ul>
                </div>

            </div>
        </nav>

        <!-- Modal for Login/Signup -->
        <div class="modal fade" id="authModal2" tabindex="-1" aria-labelledby="authModal2Label" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="authModal2Label">Login / Signup</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <!-- Tabs -->
                        <ul class="nav nav-tabs" id="authTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="login-tab" data-bs-toggle="tab"
                                    data-bs-target="#login2" type="button" role="tab" aria-controls="login2"
                                    aria-selected="true">Login</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="signup-tab" data-bs-toggle="tab"
                                    data-bs-target="#signup2" type="button" role="tab" aria-controls="signup2"
                                    aria-selected="false">Signup</button>
                            </li>
                        </ul>
                        <div class="tab-content" id="authTabsContent">
                            <div class="tab-pane fade show active" id="login2" role="tabpanel"
                                aria-labelledby="login-tab" tabindex="0">
                                <!-- Login Form -->
                                <form id="loginForm" name="loginForm">
                                    <div class="mb-3">
                                        <label for="loginEmail" class="form-label">Email address</label>
                                        <input type="email" name="email" class="form-control" id="loginEmail"
                                            placeholder="email@example.com" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="loginPassword" class="form-label">Password</label>
                                        <input type="password" name="password" class="form-control"
                                            id="loginPassword" placeholder="Password" required>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-check">
                                            <input type="checkbox" class="form-check-input" id="loginRemember">
                                            <label class="form-check-label" for="loginRemember">Remember me</label>
                                        </div>
                                    </div>
                                    <div id="loginError" class="text-danger"></div>
                                    <button type="submit" class="btn btn-primary">Sign in</button>
                                </form>
                            </div>
                            <div class="tab-pane fade" id="signup2" role="tabpanel" aria-labelledby="signup-tab"
                                tabindex="0">
                                <!-- Signup Form -->
                                <form id="signupForm" name="signupForm">
                                    <div class="mb-3">
                                        <label for="signupName" class="form-label">Full Name</label>
                                        <input type="text" name="name" class="form-control" id="signupName"
                                            placeholder="Your Name" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="signupEmail" class="form-label">Email address</label>
                                        <input type="email" name="email" class="form-control" id="signupEmail"
                                            placeholder="email@example.com" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="signupPassword" class="form-label">Password</label>
                                        <input type="password" name="password" class="form-control"
                                            id="signupPassword" placeholder="Password" required>
                                    </div>
                                    <div id="signupError" class="text-danger"></div>
                                    <button type="submit" class="btn btn-primary">Sign up</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal for Login/Signup -->
        <div class="modal fade" id="authModal" tabindex="-1" aria-labelledby="authModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="authModalLabel">Login / Signup</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <!-- Tabs -->
                        <ul class="nav nav-tabs" id="authTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="login-tab" data-bs-toggle="tab"
                                    data-bs-target="#login" type="button" role="tab" aria-controls="login"
                                    aria-selected="true">Login</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="signup-tab" data-bs-toggle="tab"
                                    data-bs-target="#signup" type="button" role="tab" aria-controls="signup"
                                    aria-selected="false">Signup</button>
                            </li>
                        </ul>
                        <div class="tab-content" id="authTabsContent">
                            <div class="tab-pane fade show active" id="login" role="tabpanel"
                                aria-labelledby="login-tab" tabindex="0">
                                <!-- Login Form -->
                                <form id="loginFormModal" name="loginFormModal">
                                    <div class="mb-3">
                                        <label for="loginEmailModal" class="form-label">Email address</label>
                                        <input type="email" name="email" class="form-control" id="loginEmailModal"
                                            placeholder="email@example.com" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="loginPasswordModal" class="form-label">Password</label>
                                        <input type="password" name="password" class="form-control"
                                            id="loginPasswordModal" placeholder="Password" required>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-check">
                                            <input type="checkbox" class="form-check-input" id="loginRememberModal">
                                            <label class="form-check-label" for="loginRememberModal">Remember me</label>
                                        </div>
                                    </div>
                                    <div id="loginErrorModal" class="text-danger"></div>
                                    <button type="submit" class="btn btn-primary">Sign in</button>
                                </form>
                            </div>
                            <div class="tab-pane fade" id="signup" role="tabpanel" aria-labelledby="signup-tab"
                                tabindex="0">
                                <!-- Signup Form -->
                                <form id="signupForm" name="signupForm">
                                    <div class="mb-3">
                                        <label for="signupName" class="form-label">Full Name</label>
                                        <input type="text" name="name" class="form-control" id="signupName"
                                            placeholder="Your Name" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="signupEmail" class="form-label">Email address</label>
                                        <input type="email" name="email" class="form-control" id="signupEmail"
                                            placeholder="email@example.com" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="signupPassword" class="form-label">Password</label>
                                        <input type="password" name="password" class="form-control"
                                            id="signupPassword" placeholder="Password" required>
                                    </div>
                                    <div id="signupError" class="text-danger"></div>
                                    <button type="submit" class="btn btn-primary">Sign up</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
       <div class="container custom-space">
            <header class="d-flex flex-wrap justify-content-center py-3 mb-4 border-bottom">
                <a href="./index.html"
                    class="d-flex align-items-center mb-3 mb-md-0 me-md-auto link-body-emphasis text-decoration-none">
                    <img src="./assets/images/logo.png" alt="logo" class="bi me-2" width="40" height="45">
                </a>

                <ul class="nav nav-pills">
                    <li class="nav-item"><a href="./events.html" class="nav-link active"
                            aria-current="page">Events</a></li>
                    <li class="nav-item"><a href="./gallery.html" class="nav-link">Gallery</a></li>
                    <li class="nav-item"><a href="./about.html" class="nav-link">About us</a></li>

                    <li class="nav-item"><a href="./notice.html" class="nav-link">Notice Board</a></li>
                    <li class="nav-item"><a href="./societies.html" class="nav-link">Societies</a></li>
                    <li class="nav-item">
                        <div class="dropdown">
                            <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown"
                                aria-expanded="false">
                                Departments
                            </button>
                            <ul class="dropdown-menu dropdown-menu-dark">
                                <li><a class="dropdown-item active" href="./departments/it.html">Information Technology</a>
                                </li>


                                <li><a class="dropdown-item" href="./departments/banking.html">Banking & Finance</a></li>
                                <li><a class="dropdown-item" href="./departments/ba.html">Business Administration</a></li>
                                <li><a class="dropdown-item" href="./departments/eng.html">English Language & LIT</a>
                                </li>
                                <li><a class="dropdown-item" href="./departments/com.html">Commerce</a></li>
                                <li><a class="dropdown-item" href="./departments/law.html">Law</a></li>
                            </ul>
                        </div>
                    </li>
                    <li class="nav-item"><a href="./posts.html" class="nav-link " style="color: white;"><nav>News</nav></a></li>
                </ul>
            </header>
        </div>

    <!-- Main Content -->
    <div class="container custom-space">
        <h1 class="my-4">Posts</h1>

        <div id="posts-container" class="row">
            <!-- Posts will be loaded here -->
        </div>
    </div>

    <!-- Footer -->
    <footer class="py-5">
        <div class="container">
            <div class="row">
                <div class="col-6 col-md-2 mb-3">
                    <h5>Section</h5>
                    <ul class="nav flex-column">
                        <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-body-secondary">News</a></li>
                        <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-body-secondary">Subscription</a>
                        </li>
                        <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-body-secondary">Events</a></li>
                        <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-body-secondary">Gallery</a></li>
                        <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-body-secondary">Programs</a>
                        </li>
                    </ul>
                </div>

                <div class="col-6 col-md-2 mb-3">
                    <h5>Section</h5>
                    <ul class="nav flex-column">
                        <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-body-secondary">Merit-lists
                                Afternoon</a></li>
                        <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-body-secondary">Reserved-Lists
                                LLB(Hons)</a></li>
                        <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-body-secondary">Sport
                                Society</a></li>
                        <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-body-secondary">SampleTests</a>
                        </li>
                        <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-body-secondary">MPhilADV</a>
                        </li>
                    </ul>
                </div>

                <div class="col-6 col-md-2 mb-3">
                    <h5>Section</h5>
                    <ul class="nav flex-column">
                        <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-body-secondary">CCPC</a></li>
                        <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-body-secondary">OverSeas</a>
                        </li>
                        <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-body-secondary">Sports</a></li>
                        <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-body-secondary">Key-Note
                                Speakers</a></li>
                        <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-body-secondary">Reserved
                                2024</a></li>
                    </ul>
                </div>

                <div class="col-md-5 offset-md-1 mb-3">
                    <form>
                        <h5>Subscribe to our newsletter</h5>
                        <p>Monthly digest of what's new and exciting from us.</p>
                        <div class="d-flex flex-column flex-sm-row w-100 gap-2">
                            <label for="newsletter1" class="visually-hidden">Email address</label>
                            <input id="newsletter1" type="text" class="form-control" placeholder="Email address">
                            <button class="btn btn-primary" type="button">Subscribe</button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="d-flex flex-column flex-sm-row justify-content-between py-4 my-4 border-top">
                <p>2024 Â© University of the Punjab, Gujranwala Campus. All Rights Reserved.</p>
                <ul class="list-unstyled d-flex">

                    <li class="ms-3"><a class="link-body-emphasis" href="#"><img
                                src="./assets/images/facebook.svg" alt=""></a></li>
                    <li class="ms-3"><a class="link-body-emphasis" href="#"><img
                                src="./assets/images/instagram.svg" alt=""></a></li>
                    <li class="ms-3"><a class="link-body-emphasis" href="#"><img
                                src="./assets/images/twitter.svg" alt=""></a></li>
                </ul>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const API_BASE_URL = 'proxy.php/api/posts';
            const postsContainer = document.getElementById('posts-container');

            // Function to retrieve the authentication token from a cookie
            function getCookie(name) {
                const value = `; ${document.cookie}`;
                const parts = value.split(`; ${name}=`);
                return parts.length === 2 ? parts.pop().split(';').shift() : null;
            }

            // Function to retrieve the authentication token from a cookie and include it in the header
            function getAuthHeader() {
                const token = getCookie("accessToken");
                if (token) {
                    return {
                        'Authorization': `Bearer ${token}`
                    };
                }
                return {};
            }

            // Function to handle API errors
            function handleApiError(response) {
                if (!response.ok) {
                    console.error('API Error:', response.status, response.statusText);
                    throw new Error(`API Error: ${response.status} - ${response.statusText}`);
                }
            }

            // Function to fetch posts
            async function fetchPosts() {
                try {
                    const authHeader = getAuthHeader();
                    const response = await fetch(API_BASE_URL, {
                        method: 'GET',
                        headers: {
                            ...authHeader, // Include the authorization header
                        }
                    });
                    handleApiError(response);
                    const data = await response.json();
                    const posts = data.data?.posts || [];
                    displayPosts(posts);
                } catch (error) {
                    console.error("Error fetching posts:", error);
                    postsContainer.innerHTML = `<p class="text-danger">Failed to load posts. Error: ${error.message}</p>`;
                }
            }

            // Function to display posts
            function displayPosts(posts) {
                postsContainer.innerHTML = posts.length ? '' : '<p>No posts available.</p>';
                posts.forEach(post => {
                    const postElement = document.createElement('div');
                    postElement.classList.add('col-md-4', 'mb-4');
                    let imageUrl = post.image;
                    if (typeof imageUrl !== 'string' || !imageUrl) {
                        console.warn("Invalid or missing image URL for post:", post);
                        imageUrl = "placeholder-image.png";
                    }

                    postElement.innerHTML = `
                        <div class="card h-100">
                            <img src="${imageUrl}" class="card-img-top" alt="Post Image">
                            <div class="card-body">
                                <h5 class="card-title">${post.title}</h5>
                                <p class="card-text">${post.description}</p>
                                <div class="d-flex justify-content-end">
                                    <button class="btn btn-danger btn-sm delete-post" data-id="${post.id}">Delete</button>
                                </div>
                            </div>
                        </div>
                    `;
                    postsContainer.appendChild(postElement);
                });
                addEventListeners();
            }

            // Function to add event listeners to dynamically created elements
            function addEventListeners() {
                document.querySelectorAll('.delete-post').forEach(button => {
                    button.addEventListener('click', handleDeletePost);
                });
            }

            // Function to handle delete post event
            async function handleDeletePost(event) {
                const postId = event.target.dataset.id;
                if (confirm("Are you sure you want to delete this post?")) {
                    try {
                        const authHeader = getAuthHeader();
                        const response = await fetch(`${API_BASE_URL}/${postId}`, {
                            method: 'DELETE',
                            headers: {
                                ...authHeader, // Include the authorization header
                            }
                        });
                        handleApiError(response);
                        alert("Post deleted successfully.");
                        fetchPosts();
                    } catch (error) {
                        console.error("Error deleting post", error);
                        alert(`Failed to delete the post. Error: ${error.message}`);
                    }
                }
            }
            // Initial fetch of posts
            fetchPosts();
        });
    </script>
     <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>

</body>

</html>